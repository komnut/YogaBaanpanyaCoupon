<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Resize Image to Business Card Size</title>
  <style>
    .canvas-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      grid-template-rows: repeat(5, 1fr);
      gap: 0;
      padding: 20px;
    }
    .canvas-item {
      border: 2px solid black;
      width: 400px;
      height: 200px;
    }
    .form-section {
      margin: 20px 0;
    }
    label {
      margin-right: 10px;
    }
    input[type="text"], input[type="date"] {
      margin-right: 20px;
      padding: 5px 10px;
      font-size: 16px;
    }
    button {
      padding: 5px 15px;
      font-size: 16px;
      margin-right: 10px;
    }
    /* ซ่อนฟอร์มและรูปเมื่อ print */
    @media print {
      body > .form-section,
      #sourceImage {
        display: none !important;
      }
      .canvas-grid {
        padding: 0;
      }
      body {
        margin: 0;
      }
      .canvas-item {
        display: block !important;
      }
    }
    /* ซ่อน canvas 2-10 ตอนปกติ */
    #canvas2, #canvas3, #canvas4, #canvas5, #canvas6,
    #canvas7, #canvas8, #canvas9, #canvas10 {
      display: none;
    }
    /* แสดง canvas 2-10 ตอน print */
    @media print {
      #canvas2, #canvas3, #canvas4, #canvas5, #canvas6,
      #canvas7, #canvas8, #canvas9, #canvas10 {
        display: block !important;
      }
    }
  </style>
</head>
<body>
  <div class="form-section">
    <label for="nameInput">ชื่อ:</label>
    <input type="text" id="nameInput" placeholder="กรอกชื่อ">

    <label for="dateInput">วันหมดอายุ:</label>
    <input type="date" id="dateInput">

    <button onclick="updateCards()">Preview</button>
    <button onclick="printCanvases()">Print</button>
  </div>

  <img id="sourceImage" src="bg_20250621.jpg" style="display:none">

  <div class="canvas-grid" id="canvasGrid">
    <canvas id="canvas1" class="canvas-item" width="400" height="200"></canvas>
    <canvas id="canvas2" class="canvas-item" width="400" height="200"></canvas>
    <canvas id="canvas3" class="canvas-item" width="400" height="200"></canvas>
    <canvas id="canvas4" class="canvas-item" width="400" height="200"></canvas>
    <canvas id="canvas5" class="canvas-item" width="400" height="200"></canvas>
    <canvas id="canvas6" class="canvas-item" width="400" height="200"></canvas>
    <canvas id="canvas7" class="canvas-item" width="400" height="200"></canvas>
    <canvas id="canvas8" class="canvas-item" width="400" height="200"></canvas>
    <canvas id="canvas9" class="canvas-item" width="400" height="200"></canvas>
    <canvas id="canvas10" class="canvas-item" width="400" height="200"></canvas>
  </div>

  <script>
    const image = document.getElementById("sourceImage");
    const canvasIds = [
      'canvas1', 'canvas2', 'canvas3', 'canvas4', 'canvas5',
      'canvas6', 'canvas7', 'canvas8', 'canvas9', 'canvas10'
    ];

    // ฟังก์ชันแปลงวันที่เป็น พ.ศ. และฟอร์แมต dd/MM/yyyy
    function formatDateToThai(dateStr) {
      if (!dateStr) return '01/01/2568';
      const date = new Date(dateStr);
      if (isNaN(date)) return '';
      const day = String(date.getDate()).padStart(2, '0');
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const year = date.getFullYear() + 543;
      return `${day}/${month}/${year}`;
    }

    // ฟังก์ชันวาดการ์ดทั้งหมด
    function drawCards(name, expDate) {
      canvasIds.forEach((canvasId, index) => {
        const canvas = document.getElementById(canvasId);
        const ctx = canvas.getContext("2d");
        // ล้าง canvas ก่อนวาดใหม่
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        // วาดภาพพื้นหลัง
        ctx.drawImage(image, 0, 0, canvas.width, canvas.height);

        // ใส่ชื่อ
        ctx.font = "18px Arial";
        ctx.fillStyle = "black";
        ctx.fillText(name, 37, 174);

        // ใส่วันหมดอายุ
        ctx.font = "18px Arial";
        ctx.fillStyle = "black";
        ctx.fillText(expDate, 230, 174);

        // ใส่หมายเลข fix 1-10 ที่มุมล่างขวา
        ctx.font = "25px Arial";
        ctx.fillStyle = "red";
        ctx.textAlign = "right";
        ctx.fillText(`${index + 1}`, canvas.width - 7, canvas.height - 26);

        // reset textAlign เป็น left
        ctx.textAlign = "left";
      });
    }

    // โหลดรูปเสร็จแล้ววาดการ์ดครั้งแรก
    image.onload = () => {
      const name = document.getElementById('nameInput').value || 'ชื่อผู้ถือบัตร';
      const expDate = formatDateToThai(document.getElementById('dateInput').value);
      drawCards(name, expDate);
    };

    // ฟังก์ชันอัปเดตเมื่อกดปุ่ม Preview
    function updateCards() {
      const name = document.getElementById('nameInput').value || 'ชื่อผู้ถือบัตร';
      const expDate = formatDateToThai(document.getElementById('dateInput').value);
      drawCards(name, expDate);
    }

    // ฟังก์ชัน Print เฉพาะ Canvas
    function printCanvases() {
      window.print();
    }
  </script>
</body>
</html>
